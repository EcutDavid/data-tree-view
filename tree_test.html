<!DOCTYPE html>
<html>
<head>
	<title></title>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.1/jquery.min.js"></script>

	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/themes/default/style.min.css" />
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/jstree.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
	<script src="./data.json.js"></script>
</head>
<body>
	<form id="s">
	  <input type="search" id="q" />
	  <button type="submit">Search</button>
	</form>
	<div id="container"></div>
	<script>

		// var data = 
		// {
		// 	"NodeID": {
		// 		"IdentifierType": 0,
		// 		"NamespaceIndex": 0,
		// 		"Identifier": 84
		// 	},
		// 	"BrowseName": {
		// 		"NamespaceIndex": 0,
		// 		"Name": "root"
		// 	},
		// 	"NodeClass": 1,
		// 	"Description": {
		// 		"Locale": "",
		// 		"Text": "The root of the server address space."
		// 	},
		// 	"SubNodes": [
		// 	{
		// 		"NodeID": {
		// 			"IdentifierType": 0,
		// 			"NamespaceIndex": 0,
		// 			"Identifier": 85
		// 		},
		// 		"BrowseName": {
		// 			"NamespaceIndex": 0,
		// 			"Name": "Objects"
		// 		},
		// 		"NodeClass": 1,
		// 		"Description": {
		// 			"Locale": "",
		// 			"Text": "The browse entry point when looking for objects in the server address space."
		// 		}
		// 	},
		// 	{
		// 		"NodeID": {
		// 			"IdentifierType": 0,
		// 			"NamespaceIndex": 0,
		// 			"Identifier": 11714
		// 		},
		// 		"BrowseName": {
		// 			"NamespaceIndex": 0,
		// 			"Name": "MaxMonitoredItemsPerCall"
		// 		},
		// 		"NodeClass": 2,
		// 		"Description": {
		// 			"Locale": "",
		// 			"Text": "The maximum number of operations in a single MonitoredItem related request."
		// 		},
		// 		"SubNodes": null
		// 	}		    
		// 	]
		// };

		var allow_more_props = true;

		var converter = function (key, value) {
			if (_.isArray(value)) return value;
			if (_.isNull(value)) return undefined;

			if (value && typeof value === 'object') {
				var replacement = {};
				var new_key = "";
				var new_val = "";
				for (var k in value) {
					if (Object.hasOwnProperty.call(value, k)) {
						new_key = k;
						new_val = value[k];

						if (Object.hasOwnProperty.call(map_keys, k)) {
							new_key = map_keys[k];

							if (k == "NodeClass") {
								if (Object.hasOwnProperty.call(icon_type, new_val)) {
									new_val = icon_type[new_val];
								}
							} else if (k == "NodeID") {
								new_val = JSON.stringify(new_val);
							} else if (k == "BrowseName") {
								new_val = new_val.Name;
							}
						} else if (!allow_more_props) break;

						replacement[new_key] = new_val;
					}
				}
				return replacement;
			}
			return value;
		}
		var map_keys = {
			"NodeID": "id",
			"BrowseName": "text",
			"SubNodes": "children",
			// "NodeClass": "icon"
		};
		var icon_type = {
			1 : "glyphicon glyphicon-flash",
			2 : "glyphicon glyphicon-ok"
		};

		var data = tree_data;

		var val2 = JSON.stringify(data, converter);
		// console.log(val2);

		// console.log(JSON.parse(val2));

		var data2 = {
			'core' : {
				'data' : [
				JSON.parse(val2)
				]
			},
			"plugins" : ["checkbox", "search"]
		}

		var generate_data = function(search) {

		};

		// var data1 = {
		// 	'core' : {
		// 		'data' : [
		// 		{
		// 			"text" : "Root node",
		// 			"state" : {"opened" : true },
		// 			"children" : [
		// 			{
		// 				"text" : "Child node 1",
		// 				"state" : { "selected" : true },
		// 				"icon" : "glyphicon glyphicon-flash"
		// 			},
		// 			{ "text" : "Child node 2", "state" : { "disabled" : true } }
		// 			]
		// 		}
		// 		]
		// 	},
		// 	"plugins" : ["checkbox", "search"]
		// };
		// console.log(data2);
		// console.log(data1);


		$(function() {
			// $('#container').jstree({
			// 	"plugins" : ["checkbox"]
			// });
			$('#container').jstree(data2);
		});


		$("#s").submit(function(e) {
		  e.preventDefault();
		  $("#container").jstree(true).search($("#q").val());
		});
	</script>
</body>
</html>